<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>90. Geburtstag Maria Ronczka</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Open+Sans:wght@400;700&display=swap');

        body, html { margin: 0; padding: 0; height: 100%; font-family: 'Open Sans', sans-serif; overflow: hidden; background-color: #111; color: white; }

        /* SLIDESHOW */
        .slideshow { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
        .slideshow img { position: absolute; width: 100%; height: 100%; object-fit: cover; opacity: 0; animation: fade 25s infinite; }
        .slideshow img:nth-child(1) { animation-delay: 0s; }
        .slideshow img:nth-child(2) { animation-delay: 5s; }
        .slideshow img:nth-child(3) { animation-delay: 10s; }
        .slideshow img:nth-child(4) { animation-delay: 15s; }
        .slideshow img:nth-child(5) { animation-delay: 20s; }
        @keyframes fade { 0%, 20% { opacity: 1; } 25%, 100% { opacity: 0; } }

        /* OVERLAY */
        .hero { height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; background: rgba(0, 0, 0, 0.5); padding: 20px; box-sizing: border-box; }
        h1 { font-family: 'Dancing Script', cursive; font-size: clamp(2.5rem, 7vw, 4.5rem); margin: 10px; color: #ffd700; }
        
        .btn { background: #A0522D; color: white; border: 2px solid white; padding: 15px 35px; border-radius: 50px; font-size: 1.2rem; cursor: pointer; margin-top: 20px; }

        /* MODAL */
        .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); overflow-y: auto; }
        .modal-content { background: white; margin: 30px auto; padding: 25px; width: 90%; max-width: 450px; border-radius: 15px; color: #333; }
        input, textarea { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        
        /* STATUS BALKEN */
        #statusBox { display: none; margin-top: 15px; }
        .progress-bg { background: #eee; height: 12px; border-radius: 6px; overflow: hidden; }
        #progressBar { height: 100%; width: 0%; background: #4CAF50; transition: width 0.3s; }
    </style>
</head>
<body onclick="startAll()">

    <audio id="bgMusic" loop src="0118.mp3"></audio>

    <div class="slideshow">
        <img src="bild1.jpg" onerror="console.error('Bild 1 nicht gefunden')">
        <img src="bild2.jpg" onerror="console.error('Bild 2 nicht gefunden')">
        <img src="bild3.jpg" onerror="console.error('Bild 3 nicht gefunden')">
        <img src="bild4.jpg" onerror="console.error('Bild 4 nicht gefunden')">
        <img src="bild5.jpg" onerror="console.error('Bild 5 nicht gefunden')">
    </div>

    <div class="hero">
        <h1>90 Jahre Maria Ronczka</h1>
        <p>Samstag, 11. April 2026 | Gasthaus Greskamp</p>
        <button class="btn" onclick="openM()">Jetzt zusagen</button>
    </div>

    <div id="myModal" class="modal">
        <div class="modal-content">
            <h2 style="text-align:center; color:#A0522D">Anmeldung</h2>
            <form id="inviteForm">
                <input type="text" id="inpName" placeholder="Dein Name" required>
                <input type="tel" id="inpTel" placeholder="Telefon" required>
                <input type="number" id="inpAnzahl" placeholder="Anzahl Personen" value="1" min="1" oninput="genFields()">
                
                <div id="guestFields"></div>
                
                <input type="text" id="inpMusik" placeholder="Musikwunsch">
                <textarea id="inpNotiz" placeholder="Sonstiges"></textarea>
                
                <button type="button" class="btn" style="width:100%" onclick="sendData()">Absenden</button>

                <div id="statusBox">
                    <div class="progress-bg"><div id="progressBar"></div></div>
                    <p id="statusMsg" style="text-align:center; font-size:12px; color:#666; margin-top:5px;"></p>
                </div>
            </form>
            <button onclick="closeM()" style="margin-top:10px; background:none; border:none; color:red; cursor:pointer; width:100%;">Schließen</button>
        </div>
    </div>

    <script>
        // 1. FIREBASE SETUP
        var firebaseConfig = { databaseURL: "https://geburtstag-bff4c-default-rtdb.europe-west1.firebasedatabase.app" };
        firebase.initializeApp(firebaseConfig);
        var database = firebase.database();

        // 2. MUSIK STARTEN
        function startAll() {
            var m = document.getElementById("bgMusic");
            if(m.paused) m.play().catch(function(e){});
        }

        // 3. MODAL STEUERUNG
        function openM() { document.getElementById("myModal").style.display = "block"; }
        function closeM() { document.getElementById("myModal").style.display = "none"; }

        // 4. GÄSTE FELDER
        function genFields() {
            var c = document.getElementById("guestFields");
            var n = document.getElementById("inpAnzahl").value;
            c.innerHTML = "";
            for(var i=2; i<=n; i++) {
                var input = document.createElement("input");
                input.placeholder = "Name Gast " + i;
                input.className = "extraGuest";
                c.appendChild(input);
            }
        }

        // 5. DATEN SENDEN MIT LIVE STATUS
        function sendData() {
            var btn = document.querySelector("#inviteForm button");
            var sBox = document.getElementById("statusBox");
            var bar = document.getElementById("progressBar");
            var msg = document.getElementById("statusMsg");

            btn.disabled = true;
            sBox.style.display = "block";
            bar.style.width = "20%";
            msg.innerText = "Sammle Daten...";

            // Namen sammeln
            var extraElements = document.getElementsByClassName("extraGuest");
            var allNames = [document.getElementById("inpName").value];
            for(var j=0; j<extraElements.length; j++) {
                allNames.push(extraElements[j].value);
            }

            var data = {
                name: document.getElementById("inpName").value,
                telefon: document.getElementById("inpTel").value,
                anzahl: document.getElementById("inpAnzahl").value,
                gaeste: allNames,
                musik: document.getElementById("inpMusik").value,
                notiz: document.getElementById("inpNotiz").value,
                zeit: new Date().toLocaleString()
            };

            bar.style.width = "60%";
            msg.innerText = "Übertrage an Datenbank...";

            database.ref("anmeldungen").push(data)
                .then(function() {
                    bar.style.width = "100%";
                    msg.innerText = "Erfolgreich gespeichert!";
                    setTimeout(function() {
                        alert("Danke für deine Zusage!");
                        location.reload(); // Seite neu laden um alles zu resetten
                    }, 1000);
                })
                .catch(function(error) {
                    alert("Fehler: " + error.message);
                    btn.disabled = false;
                    sBox.style.display = "none";
                });
        }
    </script>
</body>
</html>
